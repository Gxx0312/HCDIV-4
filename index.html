import React, { useEffect, useState } from 'react';
import * as d3 from 'd3';

const SingaporeHeatmap = () => {
  const [geoData, setGeoData] = useState(null);
  const width = 800;
  const height = 600;

  useEffect(() => {

    fetch('https://chi-loong.github.io/HCDIV/assignments/sgmap.json')
      .then(response => response.json())
      .then(mapData => {
        setGeoData(mapData);
      });
  }, []);


  const populationData = {
    "Admiralty": 13600,
    "Alexandra Hill": 13220,
    "Alexandra North": 2930,
    "Aljunied": 43190,
    // ... 
  };

  if (!geoData) {
    return <div className="flex items-center justify-center h-64">Loading map data...</div>;
  }


  const projection = d3.geoMercator()
    .fitSize([width, height], geoData);


  const path = d3.geoPath().projection(projection);


  const populations = Object.values(populationData).filter(v => v > 0);
  const colorScale = d3.scaleSequential(d3.interpolateBlues)
    .domain([0, d3.max(populations)]);

  return (
    <div className="w-full max-w-4xl mx-auto p-4">
      <h2 className="text-2xl font-bold mb-4">Singapore Population Density Heatmap</h2>
      <div className="border rounded-lg p-4 bg-white">
        <svg width={width} height={height}>
          <g>
            {geoData.features.map((feature, i) => {
              const population = populationData[feature.properties.name] || 0;
              return (
                <path
                  key={i}
                  d={path(feature)}
                  fill={population > 0 ? colorScale(population) : '#eee'}
                  stroke="#fff"
                  strokeWidth="0.5"
                  className="transition-colors duration-200 hover:opacity-80"
                >
                  <title>
                    {feature.properties.name}: {population.toLocaleString()} residents
                  </title>
                </path>
              );
            })}
          </g>
        </svg>
        
        {/* Legend */}
        <div className="mt-4 flex items-center justify-center">
          <div className="flex items-center space-x-2">
            <div className="w-24 h-4 bg-gradient-to-r from-white to-blue-700" />
            <span className="text-sm">Population Density</span>
          </div>
        </div>
      </div>
    </div>
  );
};

export default SingaporeHeatmap;
